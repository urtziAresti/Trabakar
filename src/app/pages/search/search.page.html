<ion-header>
  <ion-toolbar>
    <ion-title>Busca un Viaje</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div>
    <ion-item>
      <ion-searchbar [debounce]="1000" [(ngModel)]="originSearchQuery"
                     placeholder="De"
                     show-clear-button="always"></ion-searchbar>
    </ion-item>
    <ion-item class="padding-top-xs">
      <ion-searchbar [debounce]="1000" [(ngModel)]="destinySearchQuery"
                     placeholder="A"
                     show-clear-button="always"></ion-searchbar>
    </ion-item>

    <ion-item class="padding-top-xs" (click)="openCalendar()">
      <div class="padding-left-l">
        <ion-icon slot="start" class="padding-right-xs icon-size" name="calendar-outline"></ion-icon>
        <span *ngIf="selectedDateValue.getTime() == todayDateValue.getTime()">Hoy</span>
        <span *ngIf="selectedDateValue.getTime() != todayDateValue.getTime()">
          {{ selectedDateValue |date:'dd/MM/YYYY' }}
        </span>
        <ion-popover
          #timePopover [keepContentsMounted]="true"
          [isOpen]="showDatePicker"
          alignment="center" mode="ios">
          <ng-template>
            <ion-datetime
              [preferWheel]="true" presentation="date-time"
              (ionChange)="onTimeSelected($event)"
            ></ion-datetime>
          </ng-template>
        </ion-popover>
      </div>
    </ion-item>

    <ion-item class="padding-top-xs" (click)="openSeatsSelector()">
      <div class="padding-left-l">
        <ion-icon slot="start" class="padding-right-xs icon-size" name="person-outline"></ion-icon>
        <span>{{ seatsToFind }}</span>
        <ion-popover
          #seatsPopover [keepContentsMounted]="true"
          [isOpen]="showSeatsSelector"
          alignment="center" mode="ios">
          <ng-template>
            <div class="seats-selector">
              <ion-label class="head3 bold padding-right-l">{{ seatsToFind }}</ion-label>
              <ion-icon slot="start" class="padding-right-xs icon-size" name="person-outline"></ion-icon>
              <div class="icons padding-left-xs">
                <ion-icon (click)="seatsToFind < 7 && addSeat()" name="add-outline"></ion-icon>
                <ion-icon (click)="seatsToFind > 1 && removeSeat()" name="remove-outline" class=""></ion-icon>
              </div>
            </div>
          </ng-template>
        </ion-popover>
      </div>
    </ion-item>
  </div>
  <ion-list>
    <ion-item
      *ngFor="let travel of (travelService.filterTravelsByFormValues$(originSearchQuery,destinySearchQuery,selectedDateValue,seatsToFind) | async)">
      <div class="padding-y-xl padding-left-l">
        <ion-label class="caption1 ">
          {{ travel.origin?.departureTime | date:'HH:mm' }}
        </ion-label>
        <ion-label class="caption1 padding-top-xs">
          {{travel.travelDuration }}h
        </ion-label>
        <ion-label class="caption1 padding-top-xs ">
          {{ travel.destiny?.expectedArrivalTime| date:'HH:mm' }}
        </ion-label>
      </div>

      <div class="padding-left-l route-line">
<!--        <ion-icon src="assets/sgvs/point.svg" class="start-point"></ion-icon>-->
<!--        <ion-icon src="assets/sgvs/point.svg" class="end-point"></ion-icon>-->
        <ion-label class="caption1 ">
          {{ travel.origin?.name }}
        </ion-label>
        <ion-label class="caption1 padding-top-xs">
          <div *ngIf="travel.numberOfSeatsAvailable !== undefined">
            {{ travel.numberOfSeatsAvailable }} X
            <ion-icon name="person-outline"></ion-icon>
          </div>
        </ion-label>
        <ion-label class="caption1 padding-top-xs ">
          {{ travel.destiny?.name }}
        </ion-label>
      </div>
      <div class="price-label">
        <ion-label class="head2 bold">
          {{ travel.estimatedPrice }}â‚¬
        </ion-label>
      </div>
    </ion-item>
  </ion-list>
</ion-content>
